{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "Dimension",
	"patterns": [
		{"include": "#comment"},
		{"include": "#function_definition"},
		{"include": "#type_declaration"},

		{"include": "#dimensioned_type"},
		{"include": "#identifier"},
		{"include": "#keywords"}
		
	],
	"repository": {
		"keywords" : {
			"match" : "fn|makes|does|priority|type|is|oneof|return",
			"name" : "keyword.control.dmsn"
		},
		"function_definition" : {
			"begin" : "fn",
			"end": ";",
			"beginCaptures": {"0" : {"name" : "keyword.control.fn"}},
			"patterns": [
				{"include": "#function_declaration"},
				{"include": "#block"},
				{"include": "#keywords"},
				{"include": "#dimensioned_type"},
				{"include": "#integer"}
			]
		},
		"function_declaration" :{
			"begin": "(?<=fn)",
			"end": "does|makes|priority|$",
			"endCaptures": {"0" : {"name" : "keyword.control.fn_prop"}},
			"patterns": [{"include": "#function_name"}, {"include": "#parameter_list"}]
		},
		"block" :{
			"begin" : "{",
			"end": "}",
			"patterns": [
				{"include": "#inline-assembly"},
				{"include": "source.dmsn"}
			]
		},
		"function_priority" : {
			"begin" : "priority",
			"end" : "(?=(does|makes|$))",
			"beginCaptures": {"0": {"name": "keyword.control"}},
			"patterns": [{"include": "#integer"}]
		},
		"parameter_list": {
			"begin": "\\(",
			"end": "\\)",
			"patterns": [
				{"include" : "#parameter_list"},
				{"include" : "#dimensioned_type"},
				{"include": "#parameter"},
				{"match": ":"}
				]
		},
		"type_declaration": {
			"begin" : "type",
			"end" : ";",
			"beginCaptures": {"0" : {"name": "keyword.control"}},
			"patterns" : [
				{"include":  "#dimensioned_type"},
				{"include": "#type"},
				{"match": "is", "name": "keyword.control"},
				{"match": "oneof", "name": "keyword.control"},
				{"include":  "#parameter_list"}
			]
		},
		"dimensioned_type": {
			"begin" : "[\\d\\*]*(?=\\[)",
			"end" : "\\]",
			"beginCaptures": {"0" : {"name" : "constant.numeric.dimension"}},
			"endCaptures": {"0": {"name" : "entity.name.type"}},
			"patterns": [
				{"include": "#typename"},
				{"include": "#parameter_list"}
			]
		},


		"integer": {
			"patterns": [{
				"match": "\\b(-?\\d+)\\b",
				"name": "constant.numeric"
			}]
		},
		"typename": {
			"match": "[^\\s\\(\\)\\];:,]+",
			"name": "entity.name.type"
		},
		"parameter": {
			"match": "[^\\s\\(\\)\\[\\];:,]+",
			"name": "variable.parameter"
		},
		"identifier": {
			"match": "[^\\s\\(\\)\\[\\];:,]+",
			"name": "variable"
		},
		"function_name": {
			"match": "[^\\s\\(\\)\\[\\];:,]+",
			"name": "entity.name.function"
		},
		"comment":{
			"match": "//.*",
			"name": "comment.line"
		},
		"inline-assembly" : {
			"begin" : "~",
			"end" : "~",
			"name" : "dimension.inlineassembly",
			"patterns" : [
				{"include": "source.dmsn_inline_asm"}
			],
			"captures": {
				"0" : {"name" : "entity.name.section"}
			}
		}
	},
	"scopeName": "source.dmsn"
}