{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "Dimension",
	"patterns": [
		{"include": "#function_definition"},
		{"include": "#type_declaration"},
		{
			"include": "#integer"
		},
		
		
		{"include": "#comment"},
		{"include": "#identifier"},
		{
			"include": "#type"
		}
		
	],
	"repository": {
		"function_definition" : {
			"begin" : "(?=fn)",
			"end": ";",
			"patterns": [
				{"include": "#function_declaration"},
				{"include": "#function_body"},
				{"include": "#function_output"},
				{"include" : "#function_priority"}]
		},
		"function_declaration" :{
			"begin": "fn",
			"end": "(?=(does|makes|priority|$))",
			"beginCaptures": {"0": {"name": "keyword.control"}},
			"patterns": [{"include": "#function_name"}, {"include": "#parameter_list"}]
		},
		"function_body" :{
			"begin" : "does\\s+{",
			"end": "}",
			"beginCaptures": {"0": {"name": "keyword.control"}},
			"patterns": [{"include": "#inline-assembly"}]
		},
		"function_output" : {
			"begin" : "makes",
			"end" : "(?=(does|priority|$))",
			"beginCaptures": {"0": {"name": "keyword.control"}},
			"patterns": [{"include": "#dimension"}, {"include": "#type"}]
		},
		"function_priority" : {
			"begin" : "priority",
			"end" : "(?=(does|makes|$))",
			"beginCaptures": {"0": {"name": "keyword.control"}},
			"patterns": [{"include": "#integer"}]
		},
		"parameter_list": {
			"begin": "\\(",
			"end": "\\)",
			"patterns": [
				{"include": "#parameter"},
				{"match": ":"},
				{"include" : "#dimension"},
				{"include": "#type"}]
		},
		"type_declaration": {
			"begin" : "type",
			"end" : ";",
			"beginCaptures": {"0" : {"name": "keyword.control"}},
			"patterns" : [
				{"include": "#type"},
				{"match": "is", "name": "keyword.control"},
				{"match": "oneof", "name": "keyword.control"}

			]
		},
		"dimension": {
			"match": "[\\d\\*]+",
			"name" : "constant.numeric"
		},
		"type": {
			"patterns": [{
				"begin": "\\[",
				"end": "\\]",
				"captures": {"0": {"name" : "entity.name.type"}},
				"patterns": [{
					"include": "#typename"
				}]
			}]
		},
		"integer": {
			"patterns": [{
				"match": "\\b(-?\\d+)\\b",
				"name": "constant.numeric"
			}]
		},
		"typename": {
			"match": "[^\\s\\(\\)\\[\\];:,]+",
			"name": "entity.name.type"
		},
		"parameter": {
			"match": "[^\\s\\(\\)\\[\\];:,]+",
			"name": "variable.parameter"
		},
		"identifier": {
			"match": "[^\\s\\(\\)\\[\\];:,]+",
			"name": "variable"
		},
		"function_name": {
			"match": "[^\\s\\(\\)\\[\\];:,]+",
			"name": "entity.name.function"
		},
		"comment":{
			"match": "//.*",
			"name": "comment.line"
		},
		"inline-assembly" : {
			"begin" : "~",
			"end" : "~",
			"name" : "meta.preprocessor"
			
		}
	},
	"scopeName": "source.dmsn"
}